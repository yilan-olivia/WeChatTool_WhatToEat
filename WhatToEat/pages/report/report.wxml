<!-- å¥åº·æŠ¥å‘Šé¡µ -->
<view class="container">
  <!-- æ—¶é—´é€‰æ‹© -->
  <view class="time-selector">
    <picker mode="date" value="{{startDate}}" start="{{minDate}}" end="{{maxDate}}" bindchange="onStartDateChange">
      <view class="date-item">
        <text class="date-label">å¼€å§‹æ—¥æœŸ</text>
        <text class="date-value">{{startDate}}</text>
      </view>
    </picker>
    <text class="date-separator">è‡³</text>
    <picker mode="date" value="{{endDate}}" start="{{startDate}}" end="{{maxDate}}" bindchange="onEndDateChange">
      <view class="date-item">
        <text class="date-label">ç»“æŸæ—¥æœŸ</text>
        <text class="date-value">{{endDate}}</text>
      </view>
    </picker>
    <button class="btn btn-primary query-btn" bindtap="queryReport">æŸ¥è¯¢</button>
  </view>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="stats-overview" wx:if="{{reportData}}">
    <view class="overview-title">ç»Ÿè®¡æ¦‚è§ˆ</view>
    <view class="stats-grid">
      <view class="stat-box">
        <text class="stat-value">{{reportData.totalFoods || 0}}</text>
        <text class="stat-label">èœå“æ€»æ•°</text>
      </view>
      <view class="stat-box">
        <text class="stat-value">{{reportData.totalRecipes || 0}}</text>
        <text class="stat-label">ç”Ÿæˆé£Ÿè°±</text>
      </view>
      <view class="stat-box">
        <text class="stat-value">{{reportData.avgCalories || 0}}</text>
        <text class="stat-label">å¹³å‡çƒ­é‡</text>
      </view>
      <view class="stat-box">
        <text class="stat-value">{{reportData.wasteCount || 0}}</text>
        <text class="stat-label">æµªè´¹æ•°é‡</text>
      </view>
    </view>
  </view>

  <!-- å¡è·¯é‡Œç»Ÿè®¡ -->
  <view class="calories-section" wx:if="{{reportData}}">
    <view class="section-title">å¡è·¯é‡Œæ‘„å…¥</view>
    
    <!-- æ¯å‘¨å¡è·¯é‡Œ -->
    <view class="calories-card">
      <view class="calories-header">
        <text class="calories-label">æœ¬å‘¨æ€»æ‘„å…¥</text>
        <text class="calories-value">{{weeklyCalories || 0}}</text>
        <text class="calories-unit">å¡</text>
      </view>
    </view>

    <!-- æ¯æ—¥å¡è·¯é‡Œ -->
    <view class="daily-calories" wx:if="{{dailyCalories.length > 0}}">
      <view class="daily-title">æ¯æ—¥æ‘„å…¥</view>
      <view class="daily-list">
        <view 
          class="daily-item"
          wx:for="{{dailyCalories}}" 
          wx:key="date"
        >
          <text class="daily-date">{{item.date}}</text>
          <view class="daily-bar-wrapper">
            <view class="daily-bar" style="width: {{item.calories > 2000 ? 100 : (item.calories / 2000 * 100)}}%"></view>
          </view>
          <text class="daily-value">{{item.calories}}å¡</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¥å…»å‡è¡¡æƒ…å†µ -->
  <view class="nutrition-balance-section" wx:if="{{nutritionBalance}}">
    <view class="section-title">è¥å…»å‡è¡¡æƒ…å†µ</view>
    
    <!-- ç»¼åˆè¯„åˆ† -->
    <view class="balance-score-card">
      <view class="score-circle">
        <text class="score-value">{{nutritionBalance.score}}</text>
        <text class="score-label">åˆ†</text>
      </view>
      <view class="score-info">
        <text class="score-level">{{nutritionBalance.level}}</text>
        <text class="score-desc">è¥å…»å‡è¡¡è¯„åˆ†</text>
      </view>
    </view>

    <!-- å„é¡¹è¥å…»æŒ‡æ ‡ -->
    <view class="nutrition-items">
      <!-- å¡è·¯é‡Œ -->
      <view class="nutrition-item">
        <view class="nutrition-header">
          <text class="nutrition-name">çƒ­é‡</text>
          <text class="nutrition-status nutrition-status-{{nutritionBalance.calories.statusClass}}">{{nutritionBalance.calories.status}}</text>
        </view>
        <view class="nutrition-progress">
          <view class="nutrition-progress-bar" style="width: {{nutritionBalance.calories.percentage > 100 ? 100 : nutritionBalance.calories.percentage}}%"></view>
        </view>
        <view class="nutrition-detail">
          <text class="nutrition-value">{{nutritionBalance.calories.value}}å¡</text>
          <text class="nutrition-target">/ {{nutritionBalance.calories.target}}å¡</text>
          <text class="nutrition-percentage">({{nutritionBalance.calories.percentage}}%)</text>
        </view>
      </view>

      <!-- è›‹ç™½è´¨ -->
      <view class="nutrition-item">
        <view class="nutrition-header">
          <text class="nutrition-name">è›‹ç™½è´¨</text>
          <text class="nutrition-status nutrition-status-{{nutritionBalance.protein.statusClass}}">{{nutritionBalance.protein.status}}</text>
        </view>
        <view class="nutrition-progress">
          <view class="nutrition-progress-bar" style="width: {{nutritionBalance.protein.percentage > 100 ? 100 : nutritionBalance.protein.percentage}}%"></view>
        </view>
        <view class="nutrition-detail">
          <text class="nutrition-value">{{nutritionBalance.protein.value}}g</text>
          <text class="nutrition-target">/ {{nutritionBalance.protein.target}}g</text>
          <text class="nutrition-percentage">({{nutritionBalance.protein.percentage}}%)</text>
        </view>
      </view>

      <!-- è„‚è‚ª -->
      <view class="nutrition-item">
        <view class="nutrition-header">
          <text class="nutrition-name">è„‚è‚ª</text>
          <text class="nutrition-status nutrition-status-{{nutritionBalance.fat.statusClass}}">{{nutritionBalance.fat.status}}</text>
        </view>
        <view class="nutrition-progress">
          <view class="nutrition-progress-bar" style="width: {{nutritionBalance.fat.percentage > 100 ? 100 : nutritionBalance.fat.percentage}}%"></view>
        </view>
        <view class="nutrition-detail">
          <text class="nutrition-value">{{nutritionBalance.fat.value}}g</text>
          <text class="nutrition-target">/ {{nutritionBalance.fat.target}}g</text>
          <text class="nutrition-percentage">({{nutritionBalance.fat.percentage}}%)</text>
        </view>
      </view>

      <!-- ç¢³æ°´åŒ–åˆç‰© -->
      <view class="nutrition-item">
        <view class="nutrition-header">
          <text class="nutrition-name">ç¢³æ°´åŒ–åˆç‰©</text>
          <text class="nutrition-status nutrition-status-{{nutritionBalance.carbs.statusClass}}">{{nutritionBalance.carbs.status}}</text>
        </view>
        <view class="nutrition-progress">
          <view class="nutrition-progress-bar" style="width: {{nutritionBalance.carbs.percentage > 100 ? 100 : nutritionBalance.carbs.percentage}}%"></view>
        </view>
        <view class="nutrition-detail">
          <text class="nutrition-value">{{nutritionBalance.carbs.value}}g</text>
          <text class="nutrition-target">/ {{nutritionBalance.carbs.target}}g</text>
          <text class="nutrition-percentage">({{nutritionBalance.carbs.percentage}}%)</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç»Ÿè®¡ -->
  <view class="category-stats" wx:if="{{reportData && reportData.categoryStats}}">
    <view class="section-title">åˆ†ç±»ç»Ÿè®¡</view>
    <nutrition-bar 
      nutrition-data="{{categoryNutritionData}}" 
      show-percentage="{{true}}"
    ></nutrition-bar>
  </view>

  <!-- å¥åº·å»ºè®® -->
  <view class="health-tips" wx:if="{{reportData && reportData.tips}}">
    <view class="section-title">å¥åº·å»ºè®®</view>
    <view class="tips-list">
      <view 
        class="tip-item"
        wx:for="{{reportData.tips}}" 
        wx:key="index"
      >
        <text class="tip-icon">ğŸ’¡</text>
        <text class="tip-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <empty wx:if="{{!reportData && !loading}}" text="æš‚æ— æ•°æ®ï¼Œè¯·é€‰æ‹©æ—¥æœŸèŒƒå›´æŸ¥è¯¢"></empty>
</view>

<!-- åŠ è½½ç»„ä»¶ -->
<loading show="{{loading}}" text="ç”ŸæˆæŠ¥å‘Šä¸­..."></loading>
