<!-- 拍照识别页 -->
<view class="container">
  <!-- 相机预览区域 -->
  <view class="camera-section" wx:if="{{!imagePath}}">
    <camera 
      class="camera" 
      device-position="back" 
      flash="off"
      binderror="onCameraError"
    ></camera>
    <view class="camera-guide">
      <view class="camera-frame"></view>
      <text class="camera-tip">请将食物放在框内</text>
    </view>
  </view>

  <!-- 图片预览区域 -->
  <view class="preview-section" wx:if="{{imagePath}}">
    <view class="preview-wrapper">
      <image class="preview-image" src="{{imagePath}}" mode="aspectFit"></image>
      <view class="preview-mask" bindtap="removeImage">
        <text class="mask-text">重新拍摄</text>
      </view>
    </view>
  </view>

  <!-- 识别结果 -->
  <view class="result-section" wx:if="{{recognitionResult}}">
    <view class="result-title">识别结果</view>
    <view class="result-content">
      <view class="result-item">
        <text class="result-label">菜品名称：</text>
        <text class="result-value">{{recognitionResult.name}}</text>
      </view>
      <view class="result-item" wx:if="{{recognitionResult.category}}">
        <text class="result-label">分类：</text>
        <text class="result-value">{{recognitionResult.category}}</text>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-section">
    <button class="btn btn-secondary" bindtap="chooseImage" wx:if="{{!imagePath}}">从相册选择</button>
    <button 
      class="btn btn-primary camera-btn" 
      bindtap="takePhotoWithCamera" 
      disabled="{{takingPhoto}}"
      wx:if="{{!imagePath}}"
    >
      {{takingPhoto ? '拍照中...' : '拍照'}}
    </button>
    <button 
      class="btn btn-primary" 
      bindtap="recognizeImage" 
      disabled="{{!imagePath || recognizing}}"
    >
      {{recognizing ? '识别中...' : '开始识别'}}
    </button>
  </view>

  <!-- 保存表单 -->
  <view class="form-section" wx:if="{{recognitionResult}}">
    <view class="form-title">完善信息</view>
    <view class="form-item">
      <text class="form-label">保质期</text>
      <picker 
        mode="date" 
        value="{{expireDate}}" 
        start="{{minDate}}"
        bindchange="onDateChange"
      >
        <view class="form-input">{{expireDate || '请选择保质期'}}</view>
      </picker>
    </view>
    <view class="form-item">
      <text class="form-label">备注</text>
      <textarea 
        class="form-textarea" 
        placeholder="添加备注信息..."
        value="{{remark}}"
        bindinput="onRemarkInput"
        maxlength="200"
      ></textarea>
    </view>
    <button class="btn btn-primary save-btn" bindtap="saveFood">保存菜品</button>
  </view>
</view>

<!-- 加载组件 -->
<loading show="{{loading}}" text="{{loadingText}}"></loading>