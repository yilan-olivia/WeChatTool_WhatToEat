# What To Eat - 家庭菜品管理与智能食谱小程序

## 1. 项目简介
"What To Eat" 是一款基于微信小程序云开发的智能家庭菜品管理工具。它旨在帮助用户高效管理冰箱库存、减少食物浪费，并通过 AI 技术根据现有食材生成个性化食谱，同时提供社区分享功能，打造一个健康、便捷的饮食管理平台。

## 2. 核心功能

### 🥬 菜品管理
- **录入与编辑**：支持手动录入和拍照识别（AI 识别）添加菜品。
- **库存监控**：实时查看食材数量、保质期，支持过期提醒。
- **智能分类**：自动对食材进行分类管理（蔬菜、肉类、水果等）。
- **软删除机制**：数据删除采用标记删除（`isDeleted`），防止误删并支持数据恢复。

### 🍳 智能食谱
- **AI 生成**：根据当前“可用”食材（未过期、未删除），结合用户口味偏好（清淡、香辣等），智能生成推荐食谱。
- **营养分析**：自动计算食谱的热量、蛋白质、脂肪等营养数据。
- **一键保存**：生成的食谱可直接保存到个人食谱库。

### 🏘️ 美食社区
- **分享与互动**：用户可发布自己的食谱到社区。
- **发现美食**：浏览他人分享的食谱，支持点赞、收藏功能。
- **详情展示**：查看食谱的详细步骤、配料及图片。

### 👤 用户中心
- **数据隔离**：基于 OpenID 的用户数据隔离，保障隐私安全。
- **健康报告**：基于饮食记录生成的健康分析报告。
- **个人设置**：自定义偏好设置。

## 3. 技术架构

### 前端
- **框架**：微信小程序原生框架 (WXML, WXSS, JavaScript, JSON)
- **UI 组件**：自定义组件（卡片、加载动画、空状态等） + WeUI
- **工具库**：封装了数据库操作 (`db.js`)、日期处理、缓存管理等通用工具。

### 后端 (云开发)
- **云数据库 (Cloud Database)**：NoSQL 数据库，存储用户信息、菜品、食谱等数据。
- **云函数 (Cloud Functions)**：
  - `user-login`: 用户登录与鉴权，获取 OpenID。
  - `recipe-generate`: 调用 AI 接口生成食谱。
  - `food-recognition`: 图片识别服务。
  - `expire-reminder`: 定时任务，检查并发送过期提醒。
  - `community`: 处理社区帖子、点赞等逻辑。
- **云存储 (Cloud Storage)**：存储用户头像、菜品图片、社区图片。

## 4. 目录结构

```
WhatToEat/
├── cloudfunctions/      # 云函数目录
│   ├── user-login/      # 用户登录
│   ├── recipe-generate/ # 食谱生成
│   ├── community/       # 社区逻辑
│   └── ...
├── components/          # 公共组件
│   ├── food-card/       # 菜品卡片
│   ├── nutrition-bar/   # 营养成分条
│   └── ...
├── config/              # 全局配置
├── database/            # 数据库相关文档与脚本
├── images/              # 静态资源图片
├── pages/               # 页面目录
│   ├── index/           # 首页
│   ├── food-manage/     # 菜品管理
│   ├── recipe-generate/ # 食谱生成
│   ├── community/       # 社区
│   ├── profile/         # 个人中心
│   └── ...
├── utils/               # 工具函数
├── app.js               # 全局入口
├── app.json             # 全局配置
└── project.config.json  # 项目配置文件
```

## 5. 安全与权限

本项目严格遵循微信云开发安全规范：

1.  **用户数据隔离**：
    *   所有私有数据（菜品、私人食谱）均包含 `userId` (OpenID) 字段。
    *   前端 `db.js` 及各业务页面在查询时强制校验 `userId`。
    *   数据库安全规则设置为仅创建者可读写。

2.  **软删除支持**：
    *   数据表包含 `isDeleted` 字段。
    *   删除操作仅将 `isDeleted` 设为 `true`。
    *   查询操作默认过滤 `isDeleted: false`。

3.  **云资源访问**：
    *   云存储图片链接使用 `wx.cloud.getTempFileURL` 转换为临时 HTTPS 链接，确保存储安全及跨平台兼容性。

## 6. 快速开始

1.  **环境准备**：
    *   安装 [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)。
    *   开通微信云开发环境。

2.  **配置项目**：
    *   导入项目到微信开发者工具。
    *   在 `project.config.json` 中配置你的 `appid`。
    *   在 `config/env.js` (如有) 或云开发控制台关联你的云环境 ID。

3.  **部署云资源**：
    *   上传并部署 `cloudfunctions` 目录下的所有云函数。
    *   在云数据库中创建集合：`foods`, `recipes`, `users`, `community_posts` 等。
    *   根据 `database/security-rules.json` 配置数据库权限。

4.  **运行**：
    *   点击开发者工具的“编译”按钮即可运行。

## 7. 开发注意事项

- **登录校验**：在进行增删改查操作前，务必调用 `getUserId()` 确保用户已登录。
- **图片处理**：展示云存储图片时，需处理 `cloud://` 协议链接，防止渲染层网络错误。
- **缓存管理**：修改数据后，及时清理相关缓存（如 `food_count`），确保界面数据同步。
